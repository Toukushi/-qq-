<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>QQéŸ³ä¹æ­Œå•è§£æ</title>
    <style>
        body {
            font-family: Arial;
            max-width: 800px;
            margin: 40px auto;
        }
        input {
            width: 500px;
            padding: 8px;
        }
        button {
            padding: 8px 15px;
            margin-left: 5px;
        }
        .song {
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }
        #copyBtn {
            margin-top: 15px;
            display: none;
        }
    </style>
</head>
<body>

<h1>ğŸµ QQéŸ³ä¹æ­Œå•è§£æ</h1>

<input type="text" id="playlistUrl" placeholder="è¾“å…¥QQéŸ³ä¹æ­Œå•é“¾æ¥">
<button onclick="fetchList()">è§£æ</button>
<button id="copyBtn" onclick="copySongs()">ä¸€é”®å¤åˆ¶æ­Œæ›²åˆ—è¡¨</button>

<h2 id="title"></h2>
<div id="result"></div>

<script>
let currentSongText = "";

async function fetchList() {
    const url = document.getElementById('playlistUrl').value;
    const res = await fetch(`/api/playlist?url=${encodeURIComponent(url)}`);
    const data = await res.json();

    if (data.error) {
        alert(data.error);
        return;
    }

    document.getElementById('title').innerText =
        `${data.name}ï¼ˆå…± ${data.songCount} é¦–ï¼‰`;

    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '';

    currentSongText = "";

    data.songs.forEach(song => {
        const line = `${song.singer} - ${song.name}`;
        currentSongText += line + "\n";

        const div = document.createElement('div');
        div.className = 'song';
        div.innerText = line;
        resultDiv.appendChild(div);
    });

    // æ˜¾ç¤ºå¤åˆ¶æŒ‰é’®
    document.getElementById('copyBtn').style.display = "inline-block";
}

function copySongs() {
    navigator.clipboard.writeText(currentSongText)
        .then(() => {
            alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
        })
        .catch(() => {
            alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚");
        });
}
</script>

</body>
</html>
